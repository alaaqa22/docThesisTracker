<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
>

<f:view>
    <h:head>
        <title>Circulation Details</title>
        <link href="${request.contextPath}/resources/css/style.css" rel="stylesheet" type="text/css"/>
        <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet"/>
    </h:head>

    <h:body>
        <ui:composition template="../anonymous/template.xhtml">
        <ui:define name="mainContent">
        <h:form>
            <div class="container">
                <h2>Circulation Details</h2>

                <f:metadata>
                    <f:viewAction action="#{circulationDetailsBacking.loadCirculation()}"/>
                    <f:viewParam name="id" value="#{circulationDetailsBacking.circulation.id}"/>
                    <f:viewAction action="#{circulationDetailsBacking.loadVotes()}"/>
                    <f:viewParam name="voteId" value="#{circulationDetailsBacking.vote.voteId}"/>
                </f:metadata>

                <div class="form-group">
                    <label for="title-otxt">Title:</label>
                    <h:inputText id="title-otxt" value="#{circulationDetailsBacking.circulation.title}"
                                 readonly="#{!sessionInfo.deanery}" class="form-control"/>
                </div>

                <div class="form-group">
                    <label for="doctoralcandidatename-otxt">Doctoral Candidate Name:</label>
                    <h:inputText id="doctoralcandidatename-otxt"
                                 value="#{circulationDetailsBacking.circulation.doctoralCandidateName}"
                                 readonly="#{!sessionInfo.deanery}" class="form-control"/>
                </div>

                <div class="form-group">
                    <label for="doctoralsupervisororotxt">Doctoral Supervisor:</label>
                    <h:inputText id="doctoralsupervisororotxt"
                                 value="#{circulationDetailsBacking.circulation.doctoralSupervisor}"
                                 readonly="#{!sessionInfo.deanery}" class="form-control"/>
                </div>

                <div class="form-group">
                    <label for="description-otxt">Description:</label>
                    <h:inputText id="description-otxt" value="#{circulationDetailsBacking.circulation.description}"
                                 readonly="#{!sessionInfo.deanery}" class="form-control"/>
                </div>

                <div class="form-group">
                    <label for="start-dateotxt">Start Date:</label>
                    <h:inputText id="start-dateotxt" value="#{circulationDetailsBacking.startDate}"
                                 readonly="#{!sessionInfo.deanery}" class="form-control">
                        <f:convertDateTime type="localDate"/>
                    </h:inputText>
                </div>

                <div class="form-group">
                    <label for="end-date-itxt">End Date:</label>
                    <h:inputText id="end-date-itxt" value="#{circulationDetailsBacking.endDate}" required="true"
                                 readonly="#{!sessionInfo.deanery}" class="form-control">
                        <f:convertDateTime type="localDate"/>
                    </h:inputText>
                </div>

                <div class="form-group">
                    <label for="created-byotxt">Created By:</label>
                    <h:outputText id="created-byotxt" value="#{circulationDetailsBacking.circulation.createdBy}"
                                  class="form-control"/>
                </div>

                <div class="form-group">
                    <label for="faculty-idotxt">Faculty ID:</label>
                    <h:outputText id="faculty-idotxt" value="#{circulationDetailsBacking.circulation.facultyId}"
                                  class="form-control"/>
                </div>

                <div class="form-group">
                    <label for="vote-optionsslcom">Select vote:</label>
                    <h:selectOneMenu id="vote-optionsslcom" value="#{circulationDetailsBacking.choice}"
                                     class="form-control">
                        <f:selectItems value="#{circulationDetailsBacking.options}" var="option"
                                       itemValue="#{option}" itemLabel="#{option.label}"/>
                    </h:selectOneMenu>
                </div>

                <div class="form-group">
                    <label for="reason-itxt">Erkl√§rung:</label>
                    <h:inputText id="reason-itxt" value="#{circulationDetailsBacking.reason}" class="form-control"/>
                </div>

                <h:commandButton id="vote-btn" action="#{circulationDetailsBacking.submitVote()}" value="Vote"
                                 class="btn btn-primary"/>

                <h:commandButton id="modify-cbtn" action="#{circulationDetailsBacking.modify()}" value="Modify"
                                 update="circulationDetailsPanel" rendered="#{!sessionInfo.examiner}"
                                 class="btn btn-primary"/>

                <h:commandButton id="remove-cbtn" action="#{circulationDetailsBacking.remove()}"
                                 value="Remove Circulation" rendered="#{!sessionInfo.examiner}"
                                 class="btn btn-danger"/>

                <h:outputText id="votes-otxt"
                              value="Total votes to this circulation: #{circulationDetailsBacking.totalVotes.size()}"/>

                <h:dataTable value="#{circulationDetailsBacking.totalVotes}" var="vote"
                             rendered="#{!sessionInfo.examiner}" class="table table-bordered">
                    <h:column>
                        <f:facet name="header">Voted by</f:facet>
                        #{vote.userId}
                    </h:column>
                    <h:column>
                        <f:facet name="header">Vote selection</f:facet>
                        #{vote.selection}
                    </h:column>
                    <h:column>
                        <f:facet name="header">Vote reason</f:facet>
                        #{vote.description}
                    </h:column>
                </h:dataTable>
            </div>
        </h:form>
        </ui:define>
        </ui:composition>
    </h:body>
</f:view>

</html>
